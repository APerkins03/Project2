<html>
<head>
  <title>Registered Events</title>
</head>
<body>
  <p>User ID: {{userId}}</p>
  <h1>Registered Events</h1>
  
  {{#if events.length}}
    {{#each events}}
      <div>
        <h2>{{bandname}}</h2>
        <p>Singer: {{singer}}</p>
        <p>License Number: {{licensenumber}}</p>
        <p>Address: {{address}}</p>
        <p>Email: {{email}}</p>
      </div>
      <div>
  <form id="updateForm">
    <input type="hidden" name="_method" value="PUT">

    <label for="bandname">Band Name:</label>
    <input type="text" id="bandname" name="bandname" value="{{this.bandname}}" required>

    <label for="singer">Singer:</label>
    <input type="text" id="singer" name="singer" value="{{this.singer}}" required>

    <label for="licensenumber">License Number:</label>
    <input type="text" id="licensenumber" name="licensenumber" value="{{this.licensenumber}}" required>

    <label for="address">Address:</label>
    <input type="text" id="address" name="address" value="{{this.address}}" required>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" value="{{this.email}}" required>

    <button type="submit" onclick="updateEvent('{{this._id}}')">Update Event</button>
    <button type="button" onclick="deleteEvent('{{this._id}}')">Delete Event</button>
  </form>
</div>
    {{/each}}
  {{else}}
    <p>No events found.</p>
  {{/if}}
<script src="./events.routes.js"></script>
<script>
  function updateEvent(eventId) {
  var updatedEventData = {
    bandname: document.getElementById('bandname').value,
    singer: document.getElementById('singer').value,
    licensenumber: document.getElementById('licensenumber').value,
    address: document.getElementById('address').value,
    email: document.getElementById('email').value,
  };

  fetch(`/events/${eventId}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(updatedEventData),
  })
    .then((response) => {
      if (response.ok) {
        return response.json();
      } else {
        throw new Error('Event update failed');
      }
    })
    .then((data) => {
      console.log(data.message);
      window.location.href = '/events';
    })
    .catch((error) => {
      console.error(error);
    });
}

  function deleteEvent(eventId) {
    // Send a DELETE request to the server using AJAX
    fetch(`/events/${eventId}`, {
      method: 'DELETE'
    })
      .then(response => {
        // Handle the response from the server
        if (response.ok) {
          // The deletion was successful
          alert('Event deleted successfully');
          // Redirect or update the UI as needed
          window.location.href = '/registeredevents'; // Redirect to the desired page
        } else {
          // The deletion failed
          alert('Failed to delete event');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while deleting the event');
      });
  }
</script>
</body>